/*! @name videojs-vast-vpaid-waterfall @version 1.1.2011 @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsVastVpaidWaterfall=t(e.videojs)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e),a="6.9.0";
/*! @name videojs-contrib-ads @version 6.9.0 @license Apache-2.0 */var o=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},r=function(e,t,n){o(0,n),e.trigger({type:t+n.type,originalEvent:n})};function i(e){"playing"===e.type?function(e,t){e.ads.isInAdMode()&&(e.ads.isContentResuming()?e.ads._contentEnding&&r(e,"content",t):r(e,"ad",t))}(this,e):"ended"===e.type?function(e,t){e.ads.isInAdMode()?e.ads.isContentResuming()?(o(0,t),e.trigger("resumeended")):r(e,"ad",t):e.ads._contentHasEnded||e.ads.stitchedAds()||(r(e,"content",t),e.trigger("readyforpostroll"))}(this,e):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.inAdBreak())r(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;r(e,"content",t)}}(this,e):"play"===e.type?function(e,t){e.ads.inAdBreak()?r(e,"ad",t):e.ads.isContentResuming()&&r(e,"content",t)}(this,e):this.ads.isInAdMode()&&(this.ads.isContentResuming()?r(this,"content",e):r(this,"ad",e))}var s={},d=function(){!function(e){if(n.default.dom.isInFrame()&&"function"!=typeof window.__tcfapi){for(var t,a=window,o={};a;){try{if(a.frames.__tcfapiLocator){t=a;break}}catch(e){}if(a===window.top)break;a=a.parent}if(!t)return;window.__tcfapi=function(e,n,a,r){var i=Math.random()+"",s={__tcfapiCall:{command:e,parameter:r,version:n,callId:i}};o[i]=a,t.postMessage(s,"*")},window.addEventListener("message",(function(e){var t={};try{t="string"==typeof e.data?JSON.parse(e.data):e.data}catch(e){}var n=t.__tcfapiReturn;n&&"function"==typeof o[n.callId]&&(o[n.callId](n.returnValue,n.success),o[n.callId]=null)}),!1)}}(),"function"==typeof window.__tcfapi&&window.__tcfapi("addEventListener",2,(function(e,t){t&&(s=e)}))},l=function(e,t){return t?encodeURIComponent(e):e},u=function(e,t,n){if(e&&e[n])for(var a=e[n],o=Object.keys(a),r=0;r<o.length;r++){t["{mediainfo."+n+"."+o[r]+"}"]=a[o[r]]}};function c(e,t,a){var o=this,r={};e=e.replace(/{([^}=]+)=([^}]+)}/g,(function(e,t,n){return r["{"+t+"}"]=n,"{"+t+"}"})),void 0===t&&(t=!1);var i={};for(var d in void 0!==a&&(i=a),i["{player.id}"]=this.options_["data-player"]||this.id_,i["{player.height}"]=this.currentHeight(),i["{player.width}"]=this.currentWidth(),i["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",i["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",i["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",i["{player.duration}"]=this.duration(),i["{player.pageUrl}"]=n.default.dom.isInFrame()?document.referrer:window.location.href,i["{playlistinfo.id}"]=this.playlistinfo?this.playlistinfo.id:"",i["{playlistinfo.name}"]=this.playlistinfo?this.playlistinfo.name:"",i["{timestamp}"]=(new Date).getTime(),i["{document.referrer}"]=document.referrer,i["{window.location.href}"]=window.location.href,i["{random}"]=Math.floor(1e12*Math.random()),["description","tags","reference_id","ad_keys"].forEach((function(e){o.mediainfo&&o.mediainfo[e]?i["{mediainfo."+e+"}"]=o.mediainfo[e]:r["{mediainfo."+e+"}"]?i["{mediainfo."+e+"}"]=r["{mediainfo."+e+"}"]:i["{mediainfo."+e+"}"]=""})),u(this.mediainfo,i,"custom_fields"),u(this.mediainfo,i,"customFields"),Object.keys(s).forEach((function(e){i["{tcf."+e+"}"]=s[e]})),i["{tcf.gdprAppliesInt}"]=s.gdprApplies?1:0,i)e=e.split(d).join(l(i[d],t));for(var c in e=e.replace(/{pageVariable\.([^}]+)}/g,(function(e,a){for(var o,i=window,s=a.split("."),d=0;d<s.length;d++)d===s.length-1?o=i[s[d]]:i=i[s[d]];var u=typeof o;return null===o?"null":void 0===o?r["{pageVariable."+a+"}"]?r["{pageVariable."+a+"}"]:(n.default.log.warn('Page variable "'+a+'" not found'),""):"string"!==u&&"number"!==u&&"boolean"!==u?(n.default.log.warn('Page variable "'+a+'" is not a supported type'),""):l(String(o),t)})),r)e=e.replace(c,r[c]);return e}var f={processMetadataTracks:function(e,t){for(var n=e.textTracks(),a=function(n){"metadata"===n.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(n),t(e,n))},o=0;o<n.length;o++)a(n[o]);n.addEventListener("addtrack",(function(e){a(e.track)}))},setMetadataTrackMode:function(e){},getSupportedAdCue:function(e,t){return t},isSupportedAdCue:function(e,t){return!0},getCueId:function(e,t){return t.id}},p=function(e,t){return void 0!==t&&e.ads.includedCues[t]},h=function(e,t){void 0!==t&&""!==t&&(e.ads.includedCues[t]=!0)};function g(){!1!==this.ads._shouldBlockPlay&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}f.processAdTrack=function(e,t,a,o){e.ads.includedCues={};for(var r=0;r<t.length;r++){var i=t[r],s=this.getSupportedAdCue(e,i);if(!this.isSupportedAdCue(e,i))return void n.default.log.warn("Skipping as this is not a supported ad cue.",i);var d=this.getCueId(e,i),l=i.startTime;if(p(e,d))return void n.default.log("Skipping ad already seen with ID "+d);o&&o(e,s,d,l),a(e,s,d,l),h(e,d)}};var m={},v=n.default;m.isMiddlewareMediatorSupported=function(){return!v.browser.IS_IOS&&!v.browser.IS_ANDROID&&!!(v.use&&v.middleware&&v.middleware.TERMINATOR)},m.playMiddleware=function(e){return{setSource:function(e,t){t(null,e)},callPlay:function(){if(e.ads&&!0===e.ads._shouldBlockPlay)return e.ads.debug("Using playMiddleware to block content playback"),e.ads._playBlocked=!0,v.middleware.TERMINATOR},play:function(t,a){e.ads&&e.ads._playBlocked&&t?(e.ads.debug("Play call to Tech was terminated."),e.trigger("play"),e.addClass("vjs-has-started"),e.ads._playBlocked=!1):a&&a.catch&&a.catch((function(t){"NotAllowedError"!==t.name||n.default.browser.IS_SAFARI||e.trigger("pause")}))}}},m.testHook=function(e){v=e};var y=m.playMiddleware,A=m.isMiddlewareMediatorSupported;var S=function(){function e(){}return e.getState=function(t){if(t)return e.states_&&e.states_[t]?e.states_[t]:void 0},e.registerState=function(t,n){if("string"!=typeof t||!t)throw new Error('Illegal state name, "'+t+'"; must be a non-empty string.');return e.states_||(e.states_={}),e.states_[t]=n,n},e}(),k=function(){function e(e){this.player=e}e._getName=function(){return"Anonymous State"};var t=e.prototype;return t.transitionTo=function(e){var t=this.player;this.cleanup(t);var n=new e(t);t.ads._state=n,t.ads.debug(this.constructor._getName()+" -> "+n.constructor._getName());for(var a=arguments.length,o=new Array(a>1?a-1:0),r=1;r<a;r++)o[r-1]=arguments[r];n.init.apply(n,[t].concat(o))},t.init=function(){},t.cleanup=function(){},t.onPlay=function(){},t.onPlaying=function(){},t.onEnded=function(){},t.onAdEnded=function(){},t.onAdsReady=function(){n.default.log.warn("Unexpected adsready event")},t.onAdsError=function(){},t.onAdsCanceled=function(){},t.onAdTimeout=function(){},t.onAdStarted=function(){},t.onContentChanged=function(){},t.onContentResumed=function(){},t.onReadyForPostroll=function(){n.default.log.warn("Unexpected readyforpostroll event")},t.onNoPreroll=function(){},t.onNoPostroll=function(){},t.startLinearAdMode=function(){n.default.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.endLinearAdMode=function(){n.default.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.skipLinearAdMode=function(){n.default.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},t.isWaitingForAdBreak=function(){return!1},t.isContentResuming=function(){return!1},t.inAdBreak=function(){return!1},t.handleEvent=function(e){var t=this.player;"play"===e?this.onPlay(t):"adsready"===e?this.onAdsReady(t):"adserror"===e?this.onAdsError(t):"adscanceled"===e?this.onAdsCanceled(t):"adtimeout"===e?this.onAdTimeout(t):"ads-ad-started"===e?this.onAdStarted(t):"contentchanged"===e?this.onContentChanged(t):"contentresumed"===e?this.onContentResumed(t):"readyforpostroll"===e?this.onReadyForPostroll(t):"playing"===e?this.onPlaying(t):"ended"===e?this.onEnded(t):"nopreroll"===e?this.onNoPreroll(t):"nopostroll"===e?this.onNoPostroll(t):"adended"===e&&this.onAdEnded(t)},e}();function w(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}S.registerState("State",k);var b=function(e){function t(t){var n;return(n=e.call(this,t)||this).contentResuming=!1,n.waitingForAdBreak=!1,n}w(t,e);var n=t.prototype;return n.isAdState=function(){return!0},n.onPlaying=function(){var e=S.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},n.onContentResumed=function(){var e=S.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},n.isWaitingForAdBreak=function(){return this.waitingForAdBreak},n.isContentResuming=function(){return this.contentResuming},n.inAdBreak=function(){return!0===this.player.ads._inLinearAdMode},t}(k);S.registerState("AdState",b);var _=function(e){function t(){return e.apply(this,arguments)||this}w(t,e);var n=t.prototype;return n.isAdState=function(){return!1},n.onContentChanged=function(e){var t=S.getState("BeforePreroll"),n=S.getState("Preroll");e.ads.debug("Received contentchanged event (ContentState)"),e.paused()?this.transitionTo(t):(this.transitionTo(n,!1),e.pause(),e.ads._pausedOnContentupdate=!0)},t}(k);S.registerState("ContentState",_);var P,T=function(e){function t(){return e.apply(this,arguments)||this}w(t,e),t._getName=function(){return"AdsDone"};var a=t.prototype;return a.init=function(e){e.ads._contentHasEnded=!0,e.trigger("ended")},a.startLinearAdMode=function(){n.default.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},t}(S.getState("ContentState"));S.registerState("AdsDone",T);var C={start:function(e){e.ads.debug("Starting ad break"),e.ads._inLinearAdMode=!0,e.trigger("adstart"),e.ads.shouldTakeSnapshots()&&(e.ads.snapshot=function(e){var t;t=n.default.browser.IS_IOS&&e.ads.isLive(e)&&e.seekable().length>0?e.currentTime()-e.seekable().end(0):e.currentTime();var a=e.$(".vjs-tech"),o=e.textTracks?e.textTracks():[],r=[],i={ended:e.ended(),currentSrc:e.currentSrc(),sources:e.currentSources(),src:e.tech_.src(),currentTime:t,type:e.currentType()};a&&(i.style=a.getAttribute("style"));for(var s=0;s<o.length;s++){var d=o[s];r.push({track:d,mode:d.mode}),d.mode="disabled"}return i.suppressedTracks=r,i}(e)),e.ads.shouldPlayContentBehindAd(e)&&(e.ads.preAdVolume_=e.volume(),e.volume(0)),e.addClass("vjs-ad-playing"),e.hasClass("vjs-live")&&e.removeClass("vjs-live"),e.ads.removeNativePoster()},end:function(e,t){e.ads.debug("Ending ad break"),void 0===t&&(t=function(){}),e.ads.adType=null,e.ads._inLinearAdMode=!1,e.trigger("adend"),e.removeClass("vjs-ad-playing"),e.ads.isLive(e)&&e.addClass("vjs-live"),e.ads.shouldTakeSnapshots()?function(e,t){var a=e.ads.snapshot;if(void 0===t&&(t=function(){}),!0===e.ads.disableNextSnapshotRestore)return e.ads.disableNextSnapshotRestore=!1,delete e.ads.snapshot,void t();var o,r=e.$(".vjs-tech"),i=20,s=a.suppressedTracks,d=function(){for(var e=0;e<s.length;e++)(o=s[e]).track.mode=o.mode},l=function(){var t;if(n.default.browser.IS_IOS&&e.ads.isLive(e)){if(a.currentTime<0&&(t=e.seekable().length>0?e.seekable().end(0)+a.currentTime:e.currentTime(),e.currentTime(t)),e.paused()){var o=e.play();o&&o.catch&&o.catch((function(e){n.default.log.warn("Play promise rejected in IOS snapshot resume",e)}))}}else if(a.ended)e.currentTime(e.duration());else{e.currentTime(a.currentTime);var r=e.play();r&&r.catch&&r.catch((function(e){n.default.log.warn("Play promise rejected in snapshot resume",e)}))}e.ads.shouldRemoveAutoplay_&&(e.autoplay(!1),e.ads.shouldRemoveAutoplay_=!1)},u=function t(){if(e.off("contentcanplay",t),P&&e.clearTimeout(P),(r=e.el().querySelector(".vjs-tech")).readyState>1)return l();if(void 0===r.seekable)return l();if(r.seekable.length>0)return l();if(i--)e.setTimeout(t,50);else try{l()}catch(e){n.default.log.warn("Failed to resume the content after an advertisement",e)}};if("style"in a&&r.setAttribute("style",a.style||""),e.ads.videoElementRecycled())e.one("resumeended",(function(){delete e.ads.snapshot,t()})),e.one("contentloadedmetadata",d),n.default.browser.IS_IOS&&!e.autoplay()&&(e.autoplay(!0),e.ads.shouldRemoveAutoplay_=!0),e.src(a.sources),e.one("contentcanplay",u),P=e.setTimeout(u,2e3);else{if(d(),!e.ended()){var c=e.play();c&&c.catch&&c.catch((function(e){n.default.log.warn("Play promise rejected in snapshot restore",e)}))}delete e.ads.snapshot,t()}}(e,t):(e.volume(e.ads.preAdVolume_),t())}},L=function(e){function t(){return e.apply(this,arguments)||this}w(t,e),t._getName=function(){return"Preroll"};var a=t.prototype;return a.init=function(e,t,n){if(this.waitingForAdBreak=!0,e.addClass("vjs-ad-loading"),n||e.ads.nopreroll_)return this.resumeAfterNoPreroll(e);var a=e.ads.settings.timeout;"number"==typeof e.ads.settings.prerollTimeout&&(a=e.ads.settings.prerollTimeout),this._timeout=e.setTimeout((function(){e.trigger("adtimeout")}),a),t?this.handleAdsReady():this.adsReady=!1},a.onAdsReady=function(e){e.ads.inAdBreak()?n.default.log.warn("Unexpected adsready event (Preroll)"):(e.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},a.handleAdsReady=function(){this.adsReady=!0,this.readyForPreroll()},a.afterLoadStart=function(e){var t=this.player;t.ads._hasThereBeenALoadStartDuringPlayerLife?e():(t.ads.debug("Waiting for loadstart..."),t.one("loadstart",(function(){t.ads.debug("Received loadstart event"),e()})))},a.noPreroll=function(){var e=this;this.afterLoadStart((function(){e.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),e.resumeAfterNoPreroll(e.player)}))},a.readyForPreroll=function(){var e=this.player;this.afterLoadStart((function(){e.ads.debug("Triggered readyforpreroll event (Preroll)"),e.trigger("readyforpreroll")}))},a.onAdsCanceled=function(e){var t=this;e.ads.debug("adscanceled (Preroll)"),this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},a.onAdsError=function(e){var t=this;n.default.log("adserror (Preroll)"),this.inAdBreak()?e.ads.endLinearAdMode():this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},a.startLinearAdMode=function(){var e=this.player;!this.adsReady||e.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(this.clearTimeout(e),e.ads.adType="preroll",this.waitingForAdBreak=!1,C.start(e),e.ads._shouldBlockPlay=!1)},a.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},a.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),e.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,C.end(e))},a.skipLinearAdMode=function(){var e=this,t=this.player;t.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart((function(){t.trigger("adskip"),t.ads.debug("skipLinearAdMode (Preroll)"),e.resumeAfterNoPreroll(t)}))},a.onAdTimeout=function(e){var t=this;this.afterLoadStart((function(){e.ads.debug("adtimeout (Preroll)"),t.resumeAfterNoPreroll(e)}))},a.onNoPreroll=function(e){e.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},a.resumeAfterNoPreroll=function(e){if(this.contentResuming=!0,e.ads._shouldBlockPlay=!1,this.cleanupPartial(e),e.ads._playRequested||e.ads._pausedOnContentupdate)if(e.paused()){e.ads.debug("resumeAfterNoPreroll: attempting to resume playback (Preroll)");var t=e.play();t&&t.then&&t.then(null,(function(e){}))}else e.ads.debug("resumeAfterNoPreroll: already playing (Preroll)"),e.trigger("play"),e.trigger("playing")},a.cleanup=function(e){e.ads._hasThereBeenALoadStartDuringPlayerLife||n.default.log.warn("Leaving Preroll state before loadstart event can cause issues."),this.cleanupPartial(e)},a.cleanupPartial=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming"),this.clearTimeout(e)},a.clearTimeout=function(e){e.clearTimeout(this._timeout),this._timeout=null},t}(S.getState("AdState"));S.registerState("Preroll",L);var R=function(e){function t(){return e.apply(this,arguments)||this}w(t,e),t._getName=function(){return"BeforePreroll"};var n=t.prototype;return n.init=function(e){this.adsReady=!1,this.shouldResumeToContent=!1,e.ads._shouldBlockPlay=!e.ads.settings.allowVjsAutoplay||!e.autoplay()},n.onAdsReady=function(e){e.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},n.onPlay=function(e){var t=S.getState("Preroll");e.ads.debug("Received play event (BeforePreroll)"),this.transitionTo(t,this.adsReady,this.shouldResumeToContent)},n.onAdsCanceled=function(e){e.ads.debug("adscanceled (BeforePreroll)"),this.shouldResumeToContent=!0},n.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.shouldResumeToContent=!0},n.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.shouldResumeToContent=!0},n.skipLinearAdMode=function(){var e=this.player;e.trigger("adskip"),e.ads.debug("skipLinearAdMode (BeforePreroll)"),this.shouldResumeToContent=!0},n.onContentChanged=function(){this.init(this.player)},t}(S.getState("ContentState"));S.registerState("BeforePreroll",R);var B=function(e){function t(){return e.apply(this,arguments)||this}w(t,e),t._getName=function(){return"Midroll"};var n=t.prototype;return n.init=function(e){e.ads.adType="midroll",C.start(e),e.addClass("vjs-ad-loading")},n.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},n.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(this.contentResuming=!0,e.addClass("vjs-ad-content-resuming"),e.removeClass("vjs-ad-loading"),C.end(e))},n.onAdsError=function(e){this.inAdBreak()&&e.ads.endLinearAdMode()},n.cleanup=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming")},t}(S.getState("AdState"));S.registerState("Midroll",B);var M=function(e){function t(){return e.apply(this,arguments)||this}w(t,e),t._getName=function(){return"Postroll"};var a=t.prototype;return a.init=function(e){if(this.waitingForAdBreak=!0,e.ads._contentEnding=!0,e.ads.nopostroll_){this.resumeContent(e);var t=S.getState("AdsDone");this.transitionTo(t)}else{e.addClass("vjs-ad-loading");var n=e.ads.settings.timeout;"number"==typeof e.ads.settings.postrollTimeout&&(n=e.ads.settings.postrollTimeout),this._postrollTimeout=e.setTimeout((function(){e.trigger("adtimeout")}),n)}},a.startLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(e.ads.adType="postroll",e.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,C.start(e))},a.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},a.endLinearAdMode=function(){var e=this,t=this.player,n=S.getState("AdsDone");this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),this.resumeContent(t),C.end(t,(function(){e.transitionTo(n)})))},a.skipLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected skipLinearAdMode invocation"):(e.ads.debug("Postroll abort (skipLinearAdMode)"),e.trigger("adskip"),this.abort(e))},a.onAdTimeout=function(e){e.ads.debug("Postroll abort (adtimeout)"),this.abort(e)},a.onAdsError=function(e){e.ads.debug("Postroll abort (adserror)"),e.ads.inAdBreak()?e.ads.endLinearAdMode():this.abort(e)},a.onContentChanged=function(e){if(this.isContentResuming()){var t=S.getState("BeforePreroll");this.transitionTo(t)}else if(!this.inAdBreak()){var n=S.getState("Preroll");this.transitionTo(n)}},a.onNoPostroll=function(e){this.isContentResuming()||this.inAdBreak()?n.default.log.warn("Unexpected nopostroll event (Postroll)"):this.abort(e)},a.resumeContent=function(e){this.contentResuming=!0,e.addClass("vjs-ad-content-resuming")},a.abort=function(e){var t=S.getState("AdsDone");this.resumeContent(e),e.removeClass("vjs-ad-loading"),this.transitionTo(t)},a.cleanup=function(e){e.removeClass("vjs-ad-content-resuming"),e.clearTimeout(this._postrollTimeout),e.ads._contentEnding=!1},t}(S.getState("AdState"));S.registerState("Postroll",M);var E=function(e){function t(){return e.apply(this,arguments)||this}w(t,e),t._getName=function(){return"ContentPlayback"};var n=t.prototype;return n.init=function(e){e.ads._shouldBlockPlay=!1},n.onAdsReady=function(e){e.ads.debug("Received adsready event (ContentPlayback)"),e.ads.nopreroll_||(e.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),e.trigger("readyforpreroll"))},n.onReadyForPostroll=function(e){var t=S.getState("Postroll");e.ads.debug("Received readyforpostroll event"),this.transitionTo(t)},n.startLinearAdMode=function(){var e=S.getState("Midroll");this.transitionTo(e)},t}(S.getState("ContentState"));S.registerState("ContentPlayback",E);var j=function(e){function t(){return e.apply(this,arguments)||this}w(t,e),t._getName=function(){return"StitchedContentPlayback"};var n=t.prototype;return n.init=function(){this.player.ads._shouldBlockPlay=!1},n.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this.constructor._getName()+")")},n.startLinearAdMode=function(){var e=S.getState("StitchedAdRoll");this.transitionTo(e)},t}(S.getState("ContentState"));S.registerState("StitchedContentPlayback",j);var I=function(e){function t(){return e.apply(this,arguments)||this}w(t,e),t._getName=function(){return"StitchedAdRoll"};var n=t.prototype;return n.init=function(){this.waitingForAdBreak=!1,this.contentResuming=!1,this.player.ads.adType="stitched",C.start(this.player)},n.onPlaying=function(){},n.onContentResumed=function(){},n.onAdEnded=function(){this.endLinearAdMode(),this.player.trigger("ended")},n.endLinearAdMode=function(){var e=S.getState("StitchedContentPlayback");C.end(this.player),this.transitionTo(e)},t}(S.getState("AdState"));S.registerState("StitchedAdRoll",I);var N=m.isMiddlewareMediatorSupported,F=n.default.getTech("Html5").Events,D={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0,liveCuePoints:!0,allowVjsAutoplay:n.default.options.normalizeAutoplay||!1},x=function(e){var t=this,o=n.default.mergeOptions(D,e),r=[];F.concat(["firstplay","loadedalldata"]).forEach((function(e){-1===r.indexOf(e)&&r.push(e)})),t.on(r,i),N()||function(e,t){t&&n.default.log("Using cancelContentPlay to block content playback"),e.on("play",g)}(t,o.debug),t.setTimeout((function(){t.ads._hasThereBeenALoadStartDuringPlayerLife||""===t.src()||n.default.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")}),5e3),t.on("ended",(function(){t.hasClass("vjs-has-started")||t.addClass("vjs-has-started")})),t.on("contenttimeupdate",(function(){t.removeClass("vjs-waiting")})),t.on(["addurationchange","adcanplay"],(function(){if(!t.ads.settings.stitchedAds&&!t.hasStarted()&&(!t.ads.snapshot||t.currentSrc()!==t.ads.snapshot.currentSrc)&&t.ads.inAdBreak()){var e=t.play();e&&e.catch&&e.catch((function(e){n.default.log.warn("Play promise rejected when playing ad",e)}))}})),t.on("nopreroll",(function(){t.ads.debug("Received nopreroll event"),t.ads.nopreroll_=!0})),t.on("nopostroll",(function(){t.ads.debug("Received nopostroll event"),t.ads.nopostroll_=!0})),t.on("playing",(function(){t.ads._cancelledPlay=!1,t.ads._pausedOnContentupdate=!1})),t.on("play",(function(){t.ads._playRequested=!0})),t.one("loadstart",(function(){t.ads._hasThereBeenALoadStartDuringPlayerLife=!0})),t.on("loadeddata",(function(){t.ads._hasThereBeenALoadedData=!0})),t.on("loadedmetadata",(function(){t.ads._hasThereBeenALoadedMetaData=!0})),t.ads=function(e){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:a,reset:function(){e.ads.disableNextSnapshotRestore=!1,e.ads._contentEnding=!1,e.ads._contentHasEnded=!1,e.ads.snapshot=null,e.ads.adType=null,e.ads._hasThereBeenALoadedData=!1,e.ads._hasThereBeenALoadedMetaData=!1,e.ads._cancelledPlay=!1,e.ads._shouldBlockPlay=!1,e.ads._playBlocked=!1,e.ads.nopreroll_=!1,e.ads.nopostroll_=!1,e.ads._playRequested=!1},startLinearAdMode:function(){e.ads._state.startLinearAdMode()},endLinearAdMode:function(){e.ads._state.endLinearAdMode()},skipLinearAdMode:function(){e.ads._state.skipLinearAdMode()},stitchedAds:function(e){return void 0!==e&&(n.default.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!e),this.settings.stitchedAds},videoElementRecycled:function(){if(e.ads.shouldPlayContentBehindAd(e))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var t=e.tech_.src()!==this.snapshot.src,n=e.currentSrc()!==this.snapshot.currentSrc;return t||n},isLive:function(t){return void 0===t&&(t=e),"boolean"==typeof t.ads.settings.contentIsLive?t.ads.settings.contentIsLive:t.duration()===1/0||"8"===n.default.browser.IOS_VERSION&&0===t.duration()},shouldPlayContentBehindAd:function(t){if(void 0===t&&(t=e),t)return!!t.ads.settings.liveCuePoints&&!n.default.browser.IS_IOS&&!n.default.browser.IS_ANDROID&&t.duration()===1/0;throw new Error("shouldPlayContentBehindAd requires a player as a param")},shouldTakeSnapshots:function(t){return void 0===t&&(t=e),!this.shouldPlayContentBehindAd(t)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var t=e.$(".vjs-tech");t&&t.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];1===t.length&&"string"==typeof t[0]?n.default.log("ADS: "+t[0]):n.default.log.apply(n.default,["ADS:"].concat(t))}}}}(t),t.ads.settings=o,o.stitchedAds=!!o.stitchedAds,o.stitchedAds?t.ads._state=new(S.getState("StitchedContentPlayback"))(t):t.ads._state=new(S.getState("BeforePreroll"))(t),t.ads._state.init(t),t.ads.cueTextTracks=f,t.ads.adMacroReplacement=c.bind(t),function(e){e.ads.contentSrc=e.currentSrc(),e.ads._seenInitialLoadstart=!1,e.on("loadstart",(function(){if(!e.ads.inAdBreak()){var t=e.currentSrc();t!==e.ads.contentSrc&&(e.ads._seenInitialLoadstart&&e.trigger({type:"contentchanged"}),e.trigger({type:"contentupdate",oldValue:e.ads.contentSrc,newValue:t}),e.ads.contentSrc=t),e.ads._seenInitialLoadstart=!0}}))}(t),t.on("contentchanged",t.ads.reset);var s=function(){var e=t.textTracks();if(!t.ads.shouldPlayContentBehindAd(t)&&t.ads.inAdBreak()&&t.tech_.featuresNativeTextTracks&&n.default.browser.IS_IOS&&!Array.isArray(t.textTracks()))for(var a=0;a<e.length;a++){var o=e[a];"showing"===o.mode&&(o.mode="disabled")}};t.ready((function(){t.textTracks().addEventListener("change",s)})),t.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],(function(e){t.ads._state.handleEvent(e.type)})),t.on("dispose",(function(){t.ads.reset(),t.textTracks().removeEventListener("change",s)})),d(),t.ads.listenToTcf=d};x.VERSION=a,function(e){!function(){if(n.default.getPlugin)return Boolean(n.default.getPlugin("ads"));var e=n.default.getComponent("Player");return Boolean(e&&e.prototype.ads)}()&&((n.default.registerPlugin||n.default.plugin)("ads",e),A()&&!n.default.usingContribAdsMiddleware_&&(n.default.use("*",y),n.default.usingContribAdsMiddleware_=!0,n.default.log.debug("Play middleware has been registered with videojs")))}(x);var O=require("vast-client");require("swfobject");var V=require("vpaid-html5-client"),U=require("vpaid-flash-client/bin/VPAIDFLASHClient");const z={preroll:[],midroll:[],postroll:[],markers:!0,flashWrapperPath:"/VPAIDFlash.swf",debug:!1};var q=n.default.registerPlugin||n.default.plugin;q("ads",x);const W=(e,t)=>{var n=[],a=[],o=0,r=0,i=e.el().querySelector(".vjs-tech"),s=document.createElement("div");s.className="vjs-vpaid-wrapper",e.el().insertBefore(s,e.controlBar.el());var d=document.createElement("div");d.className="vjs-skip-button",d.innerText="رد کردن تبلیغ",d.style.display="none",e.el().insertBefore(d,e.controlBar.el());var l,u=new O.VASTClient;if(new O.VASTParser,e.ads){if(e.ads(t),t.midroll){for(var c=0;c<t.midroll.length;c++)a[t.midroll[c].time]=!1;e.on("contentloadedmetadata",(function(){g("Ready"),f()})),e.on("timeupdate",(function(n){if(!e.ads.isInAdMode()){var i;o=Math.min.apply(Math,t.midroll.map((e=>e.time)));for(var s=0;s<t.midroll.length;s++)e.currentTime()>t.midroll[s].time&&(o=t.midroll[s].time);a[o]||(r&&(i=e.currentTime()>o&&r<o),r=e.currentTime(),i&&h("midroll"))}}))}e.on("contentchanged",(function(){e.trigger("adsready")})),e.on("readyforpreroll",(function(){t.preroll?(e.currentTime(0),h("preroll")):(e.trigger("nopreroll"),e.one("loadedmetadata",f))})),e.on("readyforpostroll",(function(){t.postroll?h("postroll"):e.trigger("nopostroll")})),e.trigger("adsready")}function f(){for(var a=0;a<t.midroll.length;a++)if(t.markers&&!n.includes(t.midroll[a].time)){n.push(t.midroll[a].time);var o=document.createElement("div");o.className="vjs-midroll-marker",o.style.left=t.midroll[a].time/e.duration()*100+"%",e.el().querySelector(".vjs-progress-holder").appendChild(o)}}function p(n,a){function o(){l.setProgress(e.currentTime()),l.skippable&&"none"==d.style.display&&(d.style.display="")}function r(){l.close()}function i(){l.setMuted(e.muted())}function c(){l.setPaused(!0)}function f(){l.setPaused(!1)}function p(){l.click()}function h(){l&&l.skip(),e.trigger("adended")}function g(){l.setFullscreen(e.isFullscreen())}l=new O.VASTTracker(u,n,a),t.skipDelay&&l.setSkipDelay(t.skipDelay),l.trackImpression(),s.addEventListener("click",p),d.addEventListener("click",h),l.on("clickthrough",(function(e){window.open(e)})),e.on("adtimeupdate",o),e.on("advolumechange",i),e.on("adpause",c),e.on("adplay",f),e.on("fullscreenchange",g),window.addEventListener("beforeunload",r),e.one("adended",(function(){l.complete(),l=null,d.removeEventListener("click",h),s.removeEventListener("click",p),e.off("adtimeupdate",o),e.off("advolumechange",i),e.off("adpause",c),e.off("adplay",f),e.off("fullscreenchange",g),window.removeEventListener("beforeunload",r)}))}function h(n){var r=0,l=0,c=t[n];function f(){e.one("adended",m),e.one("aderror",h);var n=c[l][r];function a(){var t=e.width(),n=e.height();return e.isFullscreen()&&(t=window.innerWidth,n=window.innerHeight),{width:t,height:n}}function o(t){var n=new V(s,i,{}),o=t.mediaFiles[0];e.pause(),e.controlBar.hide(),n.loadAdUnit(o.fileURL,(function(o,r){if(o)return console.error(o),e.controlBar.show(),void e.trigger("aderror");function i(){var t=a();r.resizeAd(t.width,t.height,e.isFullscreen()?"fullscreen":"normal")}r.subscribe("AdLoaded",(function(){r.startAd()})),r.subscribe("AdStarted",(function(){e.trigger("ads-ad-started"),e.on("resize",i),window.addEventListener("resize",i)})),r.subscribe("AdStopped",(function(){n.destroy(),e.controlBar.show(),e.off("resize",i),window.removeEventListener("resize",i),e.trigger("adended")})),r.handshakeVersion("2.0",(function(e,n){var o=a();r.initAd(o.width,o.height,"normal",-1,{AdParameters:t.adParameters},{})}))}))}function d(n){var o=new U(s,(function(t,n){if(t)return console.error(t),e.controlBar.show(),void e.trigger("aderror");o.loadAdUnit(r.fileURL,i)}),{data:t.flashWrapperPath}),r=n.mediaFiles[0];function i(t,i){if(t)return console.error(t),void e.trigger("aderror");function s(){o.destroy(),e.controlBar.show(),e.off("resize",d),window.removeEventListener("resize",d)}function d(){var t=a();i.resizeAd(t.width,t.height,e.isFullscreen()?"fullscreen":"normal")}i.handshakeVersion("2.0",(function(t,o){var s=a();i.initAd(s.width,s.height,"normal",r.bitRate,{AdParameters:n.adParameters},"",(function(t){e.trigger("ads-ad-started"),e.on("resize",d),window.addEventListener("resize",d)}))})),i.on("AdLoaded",(function(e,t){i.startAd()})),i.on("AdStopped",(function(t,n){s(),e.trigger("adended")})),i.on("AdError",(function(t,n){console.error(t),s(),e.trigger("aderror")})),i.on("AdStarted",(function(t,n){i.getAdIcons(),i.setAdVolume(e.volume())}))}e.controlBar.hide(),e.pause()}g("Attempting",n),u.get(n,{withCredentials:!0}).then((function(t){for(var a=t.ads,r=0;r<a.length;r++)for(var i=0;i<a[r].creatives.length;i++){var s=a[r].creatives[i],l=!1;switch(s.type){case"linear":for(var u=[],c=0;c<s.mediaFiles.length;c++){var f=s.mediaFiles[c];if(f.apiFramework){if("VPAID"==f.apiFramework){if("application/x-shockwave-flash"==f.mimeType){g("Playing",n),d(s),l=!0;break}if("video/mp4"==f.mimeType){u.push({type:f.mimeType,src:f.fileURL});continue}if("application/javascript"==f.mimeType){g("Playing",n),o(s),l=!0;break}console.warn(f.mimeType,"is not supported yet"),console.log(f);continue}console.warn("No support for",f.apiFramework,"yet"),console.log(f)}else u.push({type:f.mimeType,src:f.fileURL})}l||(u.length>0?(g("Playing",n),e.src(u),e.trigger("ads-ad-started"),p(a[r],s)):(console.error("No possible sources for this creative",s),e.trigger("aderror")));break;case"non-linear":case"companion":break;default:console.warn("There's some type we don't know about:",s.type)}}})).catch((function(t){console.error(t),e.trigger("aderror")}))}function h(){e.off("adended",m),++r<c[l].length?f():m()}function m(){e.off("adended",m),e.off("aderror",h),e.trigger("ads-ad-ended"),l++,r=0,d.style.display="none",l==c.length?("midroll"==n&&(a[o]=!0),e.trigger("ads-pod-ended"),e.ads.endLinearAdMode()):f()}"midroll"==n&&(c=c.filter((e=>e.time==o))),c=c.map((e=>e.ads)),e.ads.startLinearAdMode(),f(),e.one("adplaying",(function(t){e.trigger("ads-pod-started")}))}function g(){t.debug&&console.log(...arguments)}},H=function(e={}){this.ready((()=>{W(this,n.default.mergeOptions(z,e))}))};return q("vastWaterfall",H),H.VERSION="1.1.2011",H}));
